#!/usr/bin/env bash
# Bash script that groups visitors by IP and HTTP status code, and displays this data.

if [ ! -s "apache-access.log" ]; then
	exit 1
fi

min_file_size=100
actual_file_size=$(wc -c < "apache-access.log")
if [ "$actual_file_size" -lt "$min_file_size" ]; then
    exit 1
fi

# Check if the log file has valid entries (at least one valid entry)
if ! awk '{ if (NF >= 9) exit 0; else exit 1 }' "apache-access.log"; then

    exit 1
fi

awk '{ ip_count[$1, $9]++ } END { for (key in ip_count) { split(key, arr, SUBSEP); print ip_count[key], arr[1], arr[2] } }' "apache-access.log" | sort -rn